
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Lecture 17 - Unit Tests and Defensive Programming &#8212; ME 400 Course Notes Fall 2017 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     'Fall 2017',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Numerical Differentiation" href="Numerical_Differentiation.html" />
    <link rel="prev" title="Lecture 16 - Modules and Packages" href="ME400_Lecture_16.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 8ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-bold { font-weight: bold; }
</style>
<div class="section" id="Lecture-17---Unit-Tests-and-Defensive-Programming">
<h1>Lecture 17 - Unit Tests and Defensive Programming<a class="headerlink" href="#Lecture-17---Unit-Tests-and-Defensive-Programming" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Overview,-Objectives,-and-Key-Terms">
<h2>Overview, Objectives, and Key Terms<a class="headerlink" href="#Overview,-Objectives,-and-Key-Terms" title="Permalink to this headline">¶</a></h2>
<p>In <a class="reference internal" href="ME400_Lecture_7.html"><span class="doc">Lecture 7</span></a>, errors were identified by
debugging. In this lesson, we look at ways to ensure bugs don’t exist in
the first place by using <em>unit tests</em> and <em>defensive programming</em>
techniques. Although the extent to which these tools should be used
depends quite a bit on the magnitude of the program being developed,
even their limited use should help you write better code.</p>
<div class="section" id="Objectives">
<h3>Objectives<a class="headerlink" href="#Objectives" title="Permalink to this headline">¶</a></h3>
<p>By the end of this lesson, you should be able to</p>
<ul class="simple">
<li>Write programs and functions that use <code class="docutils literal"><span class="pre">assert</span></code> statements to ensure
correctness of inputs and/or outputs.</li>
<li>Write unit tests for testing individual functions.</li>
</ul>
</div>
<div class="section" id="Key-Terms">
<h3>Key Terms<a class="headerlink" href="#Key-Terms" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>defensive programming</li>
<li><code class="docutils literal"><span class="pre">assert</span></code></li>
<li>test-driven development</li>
<li><code class="docutils literal"><span class="pre">unittest</span></code></li>
<li><code class="docutils literal"><span class="pre">unittest.TestCase</span></code></li>
<li><code class="docutils literal"><span class="pre">unittest.main</span></code></li>
</ul>
</div>
</div>
<div class="section" id="Be-on-the-Defensive">
<h2>Be on the Defensive<a class="headerlink" href="#Be-on-the-Defensive" title="Permalink to this headline">¶</a></h2>
<p>Now that we’ve learned how to write functions and put them in modules
for use by you and others, the probability that things go wrong is
higher. When you write a function with inputs, those inputs generally
have an acceptable range of types and values.</p>
<p>Often, use of incorrect types will result an exception. Recall our
function <code class="docutils literal"><span class="pre">mean_abs_error</span></code> from <a class="reference internal" href="ME400_Lecture_16.html"><span class="doc">Lecture
16</span></a>. If we pass that a single value, or
anything else that is not a sequential type, we get an error that pretty
clearly shows what is wrong:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">error_metrics</span> <span class="kn">import</span> <span class="n">mean_abs_error</span>
<span class="n">mean_abs_error</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-1-e3bca46ac261&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-green-fg">from</span> error_metrics <span class="ansi-green-fg">import</span> mean_abs_error
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span>mean_abs_error<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">0.1</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/Research/me400_notes/source/lectures/error_metrics.py</span> in <span class="ansi-cyan-fg">mean_abs_error</span><span class="ansi-blue-fg">(e)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span>     <span class="ansi-blue-fg">&#34;&#34;&#34;Mean, absolute error.&#34;&#34;&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span>     v <span class="ansi-blue-fg">=</span> <span class="ansi-cyan-fg">0</span>
<span class="ansi-green-fg">----&gt; 4</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">for</span> i <span class="ansi-green-fg">in</span> range<span class="ansi-blue-fg">(</span>len<span class="ansi-blue-fg">(</span>e<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>         v <span class="ansi-blue-fg">+=</span> abs<span class="ansi-blue-fg">(</span>e<span class="ansi-blue-fg">[</span>i<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span>     <span class="ansi-green-fg">return</span> v<span class="ansi-blue-fg">/</span>len<span class="ansi-blue-fg">(</span>e<span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">TypeError</span>: object of type &#39;float&#39; has no len()
</pre></div></div>
</div>
<p>That means that whoever called the function made an error: the function
requires a sequential type like <code class="docutils literal"><span class="pre">list</span></code>. A compiled language would
rarely allow that; Python allows it to be written, but scolds us when
executed.</p>
<p>However, the chastising automated by run-time errors cannot account for
all errors made by the caller, perhaps due to typos or a
misunderstanding of the function (that’s why we document things,
right?). A possible solution is to use <em>defensive programming</em>, which,
sort of cheekily, is the art of making our programs “idiot proof.” We
stop the user before they get too far (by checking inputs, outputs, and
intermediate values). Most often, it turns out, the idiot is us, so any
tool to help us from misusing our own code is a good one!</p>
<p>As an example (and one inspired by <a class="reference external" href="https://www.pluralsight.com/guides/python/defensive-programming-in-python">this
article</a>),
suppose we need to write a function that accepts a sequence of numbers
and maps them to the range 0 to 1. Such <em>normalization</em> is quite common
in data analysis when data ranges can span orders of magnitude while the
algorithms used to analyze such data are tuned to smaller ranges. Here’s
a first attempt:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Normalize the elements of a to the range [0 1]&quot;&quot;&quot;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
        <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">b</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">normalize</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[3]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>[0.3333333333333333, 0.6666666666666666, 1.0]
</pre></div>
</div>
</div>
<p>That works: all three numbers are in the correct range. How about</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">normalize</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[4]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>[-0.3333333333333333, 0.6666666666666666, 1.0]
</pre></div>
</div>
</div>
<p>Whoops. Something went wrong here. That first value is <em>negative</em>. The
problem is simple, and the solution depends on our original intent.
Currently, for <code class="docutils literal"><span class="pre">normalize</span></code> to do what we say it does requires that the
values in <code class="docutils literal"><span class="pre">a</span></code> are greater than or equal to zero. Is that what we
intended? If not, we have a bug to fix, and the <em>unit tests</em> to be
covered below will help us do that. However, if we really do want to
process non-negative numbers only, then we need to (1) make sure the
user knows that limitation, and (2) provide a way to terminate the
execution before the user is surprised by the wrong result. Here’s the
solution, and it uses a new <code class="docutils literal"><span class="pre">assert</span></code> statement:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">normalize_defensive</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Normalize the elements of a to the range [0 1].  Elements of a should be &gt;= 0.&quot;&quot;&quot;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Elements of a must be &gt;= 0!&#39;</span>
        <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">b</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">normalize_defensive</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[6]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>[0.3333333333333333, 0.6666666666666666, 1.0]
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">normalize_defensive</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AssertionError</span>                            Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-7-77598fd7f16e&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>normalize_defensive<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">2</span><span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">3</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">&lt;ipython-input-5-26edd58ca715&gt;</span> in <span class="ansi-cyan-fg">normalize_defensive</span><span class="ansi-blue-fg">(a)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span>     b <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>     <span class="ansi-green-fg">for</span> i <span class="ansi-green-fg">in</span> a<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 5</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">assert</span> i <span class="ansi-blue-fg">&gt;=</span> <span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;Elements of a must be &gt;= 0!&#39;</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span>         b<span class="ansi-blue-fg">.</span>append<span class="ansi-blue-fg">(</span>i<span class="ansi-blue-fg">/</span>max<span class="ansi-blue-fg">(</span>a<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      7</span>     <span class="ansi-green-fg">return</span> b

<span class="ansi-red-fg">AssertionError</span>: Elements of a must be &gt;= 0!
</pre></div></div>
</div>
<p>We’ve updated the <code class="docutils literal"><span class="pre">docstring</span></code> and added the <code class="docutils literal"><span class="pre">assert</span></code> statement. The
general syntax for <code class="docutils literal"><span class="pre">assert</span></code> is</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">condition</span><span class="p">,</span> <span class="n">message</span>
</pre></div>
</div>
<p>where <code class="docutils literal"><span class="pre">condition</span></code> must have a <code class="docutils literal"><span class="pre">bool</span></code> equivalent, and <code class="docutils literal"><span class="pre">message</span></code> is
a <code class="docutils literal"><span class="pre">str</span></code> value to print if the assertion fails. One can skip the
message, e.g.,</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="k">assert</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AssertionError</span>                            Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-8-34d369bab8db&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span><span class="ansi-green-fg">assert</span> <span class="ansi-cyan-fg">1</span> <span class="ansi-blue-fg">==</span> <span class="ansi-cyan-fg">0</span>

<span class="ansi-red-fg">AssertionError</span>:
</pre></div></div>
</div>
<p>However, including a message helps a user know what went wrong and how
to address it.</p>
<blockquote>
<div><strong>Note</strong>: Use <code class="docutils literal"><span class="pre">assert</span></code> statements to ensure (1) functions get
proper inputs, (2) functions provide proper outputs, and (3)
variables have correct values throughout program execution.</div></blockquote>
<p>You should find that <code class="docutils literal"><span class="pre">assert</span></code> statements are very useful as you
develop longer Python programs, more complex functions, etc. By
asserting that values are correct (or within a range, of a given type,
etc.) during midexecution, you can catch bugs much sooner than you might
otherwise be able to do.</p>
<blockquote>
<div><p><strong>Exercise</strong>: Modify the functions of <code class="docutils literal"><span class="pre">error_metrics</span></code> so that only
sequential types are allowed as inputs.</p>
<blockquote>
<div><em>Hint</em>: Look up the function <code class="docutils literal"><span class="pre">hasattr</span></code>.</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="Testing,-1-2-3">
<h2>Testing, 1-2-3<a class="headerlink" href="#Testing,-1-2-3" title="Permalink to this headline">¶</a></h2>
<p>We already saw in <a class="reference internal" href="ME400_Lecture_16.html"><span class="doc">Lecture 16</span></a> how to include
an executable block in a module (i.e., the <code class="docutils literal"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">&quot;__main__&quot;</span></code>
trick). That’s a pretty common place to put quick tests and
demonstrations of a module. Sometimes, though, it is useful to write
code specific for testing the logical correctness of your functions.
Enter unit tests.</p>
<p>Let’s go back to our error-metric functions. Each one has a precise
mathematical definition, and for a given input, we can compute the
expected output. For example, given <code class="docutils literal"><span class="pre">e</span> <span class="pre">=</span> <span class="pre">[0.1,</span> <span class="pre">-0.2,</span> <span class="pre">0.3]</span></code>, the mean,
absolute error is <code class="docutils literal"><span class="pre">0.2</span></code>. However, remember that we’re dealing with a
floating-point number system that uses 1’s and 0’s, and it turns out
0.1, 0.2, and 0.3 cannot be exactly represented (go try representing 0.1
as a sum of powers of two!). Hence, when we expect the result to be 0.2,
we should hope, at best, for it to satisfy something like</p>
<div class="math">
\[|result - expected| &lt; \tau\]</div>
<p>for some tolerance <span class="math">\(\tau\)</span>. Here, we’ll set that tolerance to
<span class="math">\(10^{-14}\)</span> to account not only for the 0.2 not-being-in-the-system
issue, but also to account for effects of rounding (since 0.1, 0.2, and
0.3, and their sum must be rounded along the way).</p>
<div class="section" id="unittest">
<h3><code class="docutils literal"><span class="pre">unittest</span></code><a class="headerlink" href="#unittest" title="Permalink to this headline">¶</a></h3>
<p>To automate this sort of test, we can use the built-in <code class="docutils literal"><span class="pre">unittest</span></code>
module. Its use is straightforward to show by example:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span>

<span class="kn">from</span> <span class="nn">error_metrics</span> <span class="kn">import</span> <span class="n">mean_abs_error</span><span class="p">,</span> <span class="n">rms_error</span><span class="p">,</span> <span class="n">max_abs_error</span>

<span class="k">class</span> <span class="nc">TestErrorMetrics</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;The class name is TestErrorMetrics and should indicate in some way</span>
<span class="sd">       what is being tested.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_mean_abs_error</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">e</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">]</span>
        <span class="c1"># assertAlmostEqual comparse two values (here,</span>
        <span class="c1"># mean_abs_error(e) and 0.2) and ensures they are the same</span>
        <span class="c1"># out to 14 decimal places (i.e., 10^-14)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">mean_abs_error</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_rms_error</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">e</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">rms_error</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">sqrt</span><span class="p">(</span><span class="mf">0.14</span><span class="p">),</span> <span class="n">places</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_max_abs_error</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">e</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">max_abs_error</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

</pre></div>
</div>
</div>
<p>These contents can be located in a new file, e.g.,
<code class="docutils literal"><span class="pre">test_error_metrics.py</span></code>. To run the tests, there are several options.
First, the following two lines can be added to the end of the file:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>Then, <code class="docutils literal"><span class="pre">test_error_metrics.py</span></code> can be executed using
<code class="docutils literal"><span class="pre">python</span> <span class="pre">test_error_metrics.py</span></code> or from within an environment like
Spyder. (This approach is probably how you’ve been using the homework
testers all along!)</p>
<p>In this Jupyter notebook, a different approach is needed:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">test</span> <span class="o">=</span> <span class="n">TestErrorMetrics</span><span class="p">()</span>
<span class="n">suite</span> <span class="o">=</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestLoader</span><span class="p">()</span><span class="o">.</span><span class="n">loadTestsFromModule</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
<span class="n">unittest</span><span class="o">.</span><span class="n">TextTestRunner</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">suite</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Of course, these unit tests are introducing some new syntax: what is
<code class="docutils literal"><span class="pre">class</span></code>? What is <code class="docutils literal"><span class="pre">self</span></code>? Although object-oriented programming is
outside our scope, a <code class="docutils literal"><span class="pre">class</span></code> is a user-defined type that can include
attributes (values) and functions (a bit like modules), and the <code class="docutils literal"><span class="pre">self</span></code>
variable is an <em>object</em> or <em>instance</em> of the <code class="docutils literal"><span class="pre">class</span></code>. A simple
example: <code class="docutils literal"><span class="pre">int</span></code> is actually a class, and the variable <code class="docutils literal"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">1</span></code> is an
<em>object</em> of the <code class="docutils literal"><span class="pre">int</span></code> class:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">a</span><span class="o">.</span><span class="vm">__class__</span>
</pre></div>
</div>
</div>
<p>That said, you <em>are not responsible</em> for understanding any details of
classes. The true objective here is that you can adapt the example unit
tests shown above for use in testing your own programs.</p>
<p>Now, in the tests above, just one function was used
<code class="docutils literal"><span class="pre">assertAlmostEqual</span></code>, which is great for comparing two <code class="docutils literal"><span class="pre">float</span></code> values
that may differ up to some tolerance (or, here, number of decimal
<code class="docutils literal"><span class="pre">places</span></code>). The following are some others:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">assertEqual(a,</span> <span class="pre">b)</span></code> (are <code class="docutils literal"><span class="pre">a</span></code> and <code class="docutils literal"><span class="pre">b</span></code> equal?)</li>
<li><code class="docutils literal"><span class="pre">assertTrue(condition)</span></code> (is <code class="docutils literal"><span class="pre">condition</span></code> true?)</li>
<li><code class="docutils literal"><span class="pre">assertGreater(a,</span> <span class="pre">b)</span></code> (is <code class="docutils literal"><span class="pre">a</span> <span class="pre">&gt;</span> <span class="pre">b</span></code>?)</li>
<li><code class="docutils literal"><span class="pre">assertIn(item,</span> <span class="pre">seq)</span></code> (is <code class="docutils literal"><span class="pre">item</span> <span class="pre">in</span> <span class="pre">seq</span></code>?)</li>
</ul>
<p>There are others, to be found by <code class="docutils literal"><span class="pre">dir(unittest.TestCase)</span></code> and
understood using <code class="docutils literal"><span class="pre">help</span></code>.</p>
</div>
<div class="section" id="Test-Driven-Development">
<h3>Test-Driven Development<a class="headerlink" href="#Test-Driven-Development" title="Permalink to this headline">¶</a></h3>
<p>Armed with <code class="docutils literal"><span class="pre">unittest</span></code>, may I propose a philosophy for solving
programming problems?</p>
<blockquote>
<div><strong>Note</strong>: Before implementing a function, a module, or an entire
program, <strong>write the tests</strong>. Then, at every step of your
development process, you can establish immediately whether your
implementation is doing what you think it should be doing.</div></blockquote>
<p>This is philosophy is the basis for <a class="reference external" href="https://en.wikipedia.org/wiki/Test-driven_development">test-driven
development</a>
(and, as you may note, has been encouraged all along with the homework
testing files). Although test-driven development (or TDD) is a bonafide
software development strategy, the basic concept of writing the test,
failing the test, and then writing the code to pass the test is the
important takeaway.</p>
<p>The challenge, of course, is knowing what the tests should be. Only
after careful consideration of the requirements (whether from a homework
problem statement, your boss, or a customer) can you begin to define the
tests. Over time, these tests might change (understanding improves) or
grow in number (scope creep is real). The important thing is to define
tests sufficient in number and breadth so that every line of code can be
shown to do what it is supposed to do.</p>
<blockquote>
<div><p><strong>Exercise</strong>: Implement unit tests for a linear search function that
given a sorted sequence <code class="docutils literal"><span class="pre">a</span></code> returns the first location of <code class="docutils literal"><span class="pre">v</span></code> in
the array. If <code class="docutils literal"><span class="pre">v</span></code> is not found, the location returned should be
the (last) location of the element nearest to but smaller than
<code class="docutils literal"><span class="pre">v</span></code>. The goal here is to test for normal cases and <em>edge</em> cases,
those particular cases that may break otherwise reasonable logic
(think empty sequences, unordered sequences, sequences of just one
element, <code class="docutils literal"><span class="pre">v</span></code> smaller than the smallest value in <code class="docutils literal"><span class="pre">a</span></code>, etc.) Then,
implement that linear search function to pass the tests.</p>
<p><strong>Exercise</strong>: So the same for <em>binary search</em>. <em>Hint</em>: Do you
actually need to write new tests?</p>
<p><strong>Exercise</strong>: Write unit tests for a module with functions that
analyze strings. Specifically, write the tests for three functions:
(1) <code class="docutils literal"><span class="pre">is_palindrome(s)</span></code> (that checks whether <code class="docutils literal"><span class="pre">s</span></code> is a
<a class="reference external" href="https://en.wikipedia.org/wiki/Palindrome">palindrome</a>), (2)
<code class="docutils literal"><span class="pre">longest_palindrome(s)</span></code> that returns the largest palindrome in
<code class="docutils literal"><span class="pre">s</span></code>, and (3) <code class="docutils literal"><span class="pre">longest_common_sequence(s1,</span> <span class="pre">s2)</span></code> that returns the
longest common substring shared by <code class="docutils literal"><span class="pre">s1</span></code> and <code class="docutils literal"><span class="pre">s2</span></code>.</p>
</div></blockquote>
</div>
</div>
<div class="section" id="Further-Reading">
<h2>Further Reading<a class="headerlink" href="#Further-Reading" title="Permalink to this headline">¶</a></h2>
<p>None at this time.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Lecture 17 - Unit Tests and Defensive Programming</a><ul>
<li><a class="reference internal" href="#Overview,-Objectives,-and-Key-Terms">Overview, Objectives, and Key Terms</a><ul>
<li><a class="reference internal" href="#Objectives">Objectives</a></li>
<li><a class="reference internal" href="#Key-Terms">Key Terms</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Be-on-the-Defensive">Be on the Defensive</a></li>
<li><a class="reference internal" href="#Testing,-1-2-3">Testing, 1-2-3</a><ul>
<li><a class="reference internal" href="#unittest"><code class="docutils literal"><span class="pre">unittest</span></code></a></li>
<li><a class="reference internal" href="#Test-Driven-Development">Test-Driven Development</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Further-Reading">Further Reading</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="ME400_Lecture_16.html" title="previous chapter">Lecture 16 - Modules and Packages</a></li>
      <li>Next: <a href="Numerical_Differentiation.html" title="next chapter">Numerical Differentiation</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/lectures/ME400_Lecture_17.ipynb.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Jeremy Roberts.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../_sources/lectures/ME400_Lecture_17.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>